"""
A module for utils in the utils package.
"""

import re
from datetime import datetime
from typing import Optional

from pydantic import PositiveInt


def cve_id_validator(
    cve_id: str, pattern: str, first_year: PositiveInt, _format: str
) -> str:
    """
    Check if the given string is a valid CVE identifier for a given year.
    :param cve_id: The identifier to validate
    :type cve_id: str
    :param pattern: The pattern to validate in the given string
    :type pattern: str
    :param first_year: The first year of appearance of CVE
    :type first_year: PositiveInt
    :param _format: the CVE identifier format
    :type _format: str
    :return: The validated identifier
    :rtype: str
    """
    match: Optional[re.Match[str]] = re.search(pattern, cve_id)
    if not match:
        raise ValueError(f"CVE ID must be in the format {_format}")
    year: PositiveInt = int(match[1])
    current_year: PositiveInt = datetime.now().year
    if not (first_year <= year <= current_year):
        raise ValueError(
            f"CVE ID year must be between {first_year} and {current_year}"
        )
    return cve_id


def extract_cve_ids(signature: str, pattern: str) -> list[str]:
    """
    Extract CVE IDs from a signature string.
    :param signature: The signature to analyze
    :type signature: str
    :param pattern: The pattern to use for regex
    :type pattern: str
    :return: The CVE IDS found in the signature
    :rtype: list[str]
    """
    return re.findall(pattern, signature)
